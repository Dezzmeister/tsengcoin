# Optimizations

There are several optimizations that can be made to TsengCoin.

1. The entire UTXO database is recomputed whenever we get a new block. We do this to restore UTXOs that may have been removed by pending transactions, but it would be much more efficient to just keep a list of pending removed UTXOs and add them when a new block comes in.
2. As discussed in [Networking](./Networking.md), there is a small probability that a node gets ignored if it joins the network at the wrong time. We should improve the networking algorithm to fix this.
3. A nasty possibility and consequence of this bug is the formation of orphan chains - it is possible that a node joins, gets ignored with a 1/200 chance, and misses out on a new block or two. If another node does not join in time, the ghosted node will be missing blocks, and by the time it gets un-ghosted, any blocks it receives will be orphans. If a node starts receiving orphans and realizes that it's building a chain of orphans, it should assume its missing some blocks and ask a peer for missing blocks.
4. `GetBlocks` returns a giant blob of TCP data. If the blockchain is long enough, this can be too much to send at one time, even if broken into smaller packets. Furthermore, if the blockchain is long enough, new blocks may come in while a node is getting up to date. Currently, nodes don't do anything about this. A node should accept incoming blocks while it's getting up to date, and put the blocks in a temporary pool to be dealt with once the node is fully up to date. Furthermore, chunks of blocks should be sent at a time instead of potentially hundreds or thousands of blocks for a long blockchain.
5. Nodes should maintain a "ban score" for every node in the network. If a node sends garbage or invalid data, the recipient should increase the sender's ban score by some amount in accordance with the severity of the sending node's offense. If a node's ban score crosses a threshold, that node is banned and the banning node will not receive any communication from it, or send anything to it.
6. TsengScript can be compiled to save space in transactions. Similarly, difficulty can be represented in the compact "difficulty bits" format as it is in Bitcoin.
7. Forks are supported, and the current data structure allows for any number of forks off of the main chain. It does not allow for forks off of forks - these are possible albeit very rare and we may want to consider them.
8. Use a double ratchet algorithm for chain chat. The current implementation provides no forward secrecy.
